<!DOCTYPE html>
<html>
    <head>
        <script src="../../lib/autobahn.min.js"></script>
        <script src="../../cloudeebus/cloudeebus.js"></script>
        <script type="text/javascript">
		var manifest = {
			name: "cloudeebus",
			version: "v0.0 / development",
			key: "secret",
			permissions: [
				"com.intel.media-service-upnp",
				"com.intel.renderer-service-upnp",
				"org.freedesktop.DBus",
				"org.freedesktop.DisplayManager",
				"org.freedesktop.FileManager1",
				"org.freedesktop.ModemManager",
				"org.freedesktop.NetworkManager",
				"org.freedesktop.Notifications",
				"org.freedesktop.Tracker1",
				"org.gnome.Nautilus",
				"org.gnome.Rygel1",
				"org.gnome.ScreenSaver",
				"org.neard",
				"org.ofono"
			]
		};
        </script>
    </head>
   <body>
        <center><h1>cloudeebus</h1></center>
        <br>
		<textarea cols="80" rows=24 id="script">
cloudeebus.log = function(msg) {
  document.getElementById("log").innerHTML += msg + "\n";
}

var proxy, interval;

function connectSuccess() {
  var bus = cloudeebus.SessionBus();
  handler = bus.getObject("org.gnome.ScreenSaver", "/org/gnome/ScreenSaver");
  handler.connectToSignal("org.gnome.ScreenSaver", "ActiveChanged", successCB, errorCB);
  proxy = bus.getObject("org.gnome.ScreenSaver", "/", lock, errorCB);
}

function unLock() {
  proxy.SetActive(false, successCB, errorCB);
  clearInterval(interval);
}

function lock() {
  proxy.SetActive(true, lockOk, errorCB);
}

function lockOk(res) {
  interval = setInterval(unLock,3000);
}

function successCB(res) {
  cloudeebus.log("got result: " + res + "\n");
}

function errorCB(error) {
  cloudeebus.log("error: " + error + "\n");
}

cloudeebus.connect("ws://localhost:9000", manifest, connectSuccess, errorCB);
</textarea>
		<br>
		<input type="button" value="run script" onclick="eval(document.getElementById('script').value)"/>
		<input type="button" value="clear log" onclick="document.getElementById('log').innerHTML='';"/>
		<br>
		<pre id="log" style="height: 20em; overflow-y: scroll; background-color: #faa;"></pre>
   </body>
</html>
